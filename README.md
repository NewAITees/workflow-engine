# AI Workflow Engine
[![CI](https://github.com/NewAITees/workflow-engine/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/NewAITees/workflow-engine/actions/workflows/ci.yml)

GitHubã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã€3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆã®è‡ªå¾‹å‹é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Planner   â”‚    â”‚   Worker    â”‚    â”‚  Reviewer   â”‚
â”‚    Agent    â”‚    â”‚    Agent    â”‚    â”‚    Agent    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   GitHub Repository   â”‚
              â”‚  (Issues, PRs, Labels)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. **Planner Agent**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ â†’ ä»•æ§˜æ›¸ï¼ˆIssueï¼‰
2. **Worker Agent**: `status:ready` Issue â†’ ãƒ†ã‚¹ãƒˆç”Ÿæˆ â†’ å®Ÿè£… â†’ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ PRä½œæˆ
3. **Reviewer Agent**: `status:reviewing` PR â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†’ Approve/Request Changes

### Worker Agentã®è©³ç´°ãƒ•ãƒ­ãƒ¼ï¼ˆTDDï¼‰

```
status:ready
    â†“
status:implementingï¼ˆãƒ†ã‚¹ãƒˆç”Ÿæˆï¼‰
    â†“
status:implementingï¼ˆå®Ÿè£…ç”Ÿæˆï¼‰
    â†“
status:testingï¼ˆpytestå®Ÿè¡Œï¼‰
    â†“ (æˆåŠŸ)      â†“ (å¤±æ•—ã€æœ€å¤§3å›å†è©¦è¡Œ)
status:reviewing   status:implementingï¼ˆå†å®Ÿè£…ï¼‰
    â†“
PRä½œæˆ
```

## ä¸»è¦æ©Ÿèƒ½

### âœ… TDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰å¾¹åº•

Worker Agentã¯å³æ ¼ãªTDDãƒ—ãƒ­ã‚»ã‚¹ã«å¾“ã„ã¾ã™ï¼š

1. **ãƒ†ã‚¹ãƒˆç”Ÿæˆå„ªå…ˆ**: LLMãŒä»•æ§˜ã‹ã‚‰pytestãƒ†ã‚¹ãƒˆã‚’å…ˆã«ç”Ÿæˆ
2. **å®Ÿè£…ç”Ÿæˆ**: ãƒ†ã‚¹ãƒˆã‚’ãƒ‘ã‚¹ã™ã‚‹å®Ÿè£…ã‚’LLMãŒç”Ÿæˆ
3. **è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: WorkerãŒpytestã‚’è‡ªå‹•å®Ÿè¡Œ
4. **å¤±æ•—æ™‚ã®è‡ªå‹•å†è©¦è¡Œ**: ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã€å¤±æ•—å‡ºåŠ›ã‚’LLMã«æ¸¡ã—ã¦å†å®Ÿè£…ï¼ˆæœ€å¤§3å›ï¼‰
5. **å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹å¾Œã«PRä½œæˆ**: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã¾ã§PRã‚’ä½œæˆã—ãªã„

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ã‚³ãƒ¼ãƒ‰å“è³ªã®è‡ªå‹•ä¿è¨¼
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ã‚¯ãƒ«ã®å‰Šæ¸›
- ãƒã‚°ã®æ—©æœŸç™ºè¦‹
- é€æ˜ãªé€²æ—è¿½è·¡ï¼ˆGitHub Issue/PRã‚³ãƒ¡ãƒ³ãƒˆï¼‰

### ğŸ”„ ã‚¯ãƒ©ãƒƒã‚·ãƒ¥è€æ€§ãƒ»è‡ªå‹•å†é–‹

å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯ä¸€æ„ã®IDãŒä»˜ä¸ã•ã‚Œã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®è‡ªå‹•å¾©æ—§ãŒå¯èƒ½ï¼š

1. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID**: å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ä¸€æ„ã®IDï¼ˆä¾‹: `worker-a1b2c3d4`ï¼‰
2. **30åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ãƒ­ãƒƒã‚¯ã¯30åˆ†å¾Œã«è‡ªå‹•å¤±åŠ¹
3. **è‡ªå‹•å†é–‹**: åˆ¥ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œã«è‡ªå‹•çš„ã«ä½œæ¥­ã‚’å¼•ãç¶™ã
4. **æ‹…å½“è€…ã®å¯è¦–åŒ–**: ACKã‚³ãƒ¡ãƒ³ãƒˆã§ã©ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‡¦ç†ä¸­ã‹ç¢ºèªå¯èƒ½

**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹:**
- Workerã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã«åˆ¥ã®WorkerãŒè‡ªå‹•å†é–‹
- é•·æ™‚é–“åœæ»ã—ã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•å†å–å¾—
- è¤‡æ•°Workerã®ä¸¦è¡Œç¨¼åƒ

### ğŸ”§ CIå¤±æ•—è‡ªå‹•ä¿®æ­£

PRä½œæˆå¾Œã€Worker Agentã¯CIçŠ¶æ…‹ã‚’ç›£è¦–ã—ã€å¤±æ•—æ™‚ã«è‡ªå‹•ã§ä¿®æ­£ã‚’è©¦ã¿ã¾ã™ï¼š

1. **CIç›£è¦–**: PRä½œæˆå¾Œã€CIå®Œäº†ã¾ã§è‡ªå‹•å¾…æ©Ÿï¼ˆæœ€å¤§10åˆ†ï¼‰
2. **å¤±æ•—æ¤œå‡º**: CIãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ãŸã‚‰è©³ç´°ãƒ­ã‚°ã‚’å–å¾—
3. **è‡ªå‹•ä¿®æ­£ãƒ«ãƒ¼ãƒ—**: LLMãŒãƒ­ã‚°ã‚’åˆ†æâ†’ä¿®æ­£ç”Ÿæˆâ†’ãƒ—ãƒƒã‚·ãƒ¥â†’CIå†å®Ÿè¡Œï¼ˆæœ€å¤§3å›ï¼‰
4. **å¤±æ•—æ™‚ã®å‡¦ç†**: å…¨ãƒªãƒˆãƒ©ã‚¤å¤±æ•—æ™‚ã¯`status:ci-failed`ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸ã—ã¦é€šçŸ¥

**ãƒ¡ãƒªãƒƒãƒˆ:**
- CIå¤±æ•—ã®æ‰‹å‹•å¯¾å¿œã‚’å‰Šæ¸›
- é«˜é€Ÿãªåå¾©ã‚µã‚¤ã‚¯ãƒ«
- CI logsã‚’LLMã«æ¸¡ã—ã¦æ–‡è„ˆã‚’æä¾›
- ãƒ©ãƒ™ãƒ«ã¨ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¢ºãªå¤±æ•—è¿½è·¡

**è¨­å®š:**
- `MAX_CI_RETRIES`: è‡ªå‹•ä¿®æ­£è©¦è¡Œå›æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3å›ï¼‰
- `CI_WAIT_TIMEOUT`: CIå¾…æ©Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10åˆ†ï¼‰
- `CI_CHECK_INTERVAL`: CIãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 30ç§’ï¼‰

## å¿…è¦è¦ä»¶

- Python 3.11+
- [Codex CLI](https://github.com/openai/codex) (`codex` ã‚³ãƒãƒ³ãƒ‰) - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
- [Claude Code CLI](https://claude.ai/code) (`claude` ã‚³ãƒãƒ³ãƒ‰) - ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- [GitHub CLI](https://cli.github.com/) (`gh` ã‚³ãƒãƒ³ãƒ‰)
- Git
- pytestï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œç”¨ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. GitHub CLIã§ãƒ­ã‚°ã‚¤ãƒ³
gh auth login

# 2. Codex CLIãŒä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
codex --version

# ã¾ãŸã¯ Claude Code CLI
claude --version

# 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv sync --all-extras

# 4. pre-commitã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰
uv run pre-commit install

# 5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
cp config/repos.yml.example config/repos.yml

# 6. è¨­å®šã‚’ç·¨é›†
# repos.yml ã§ãƒªãƒã‚¸ãƒˆãƒªã¨LLMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’è¨­å®š
```

## CLIã¨ã—ã¦ä½¿ã†ï¼ˆãŠã™ã™ã‚ï¼‰

ã“ã®ãƒ¬ãƒã‚’æ”¹å–„ã—ã¤ã¤ã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå´ã«ã‚³ãƒ¼ãƒ‰ã‚’ç½®ã‹ãªã„é‹ç”¨ãŒã§ãã¾ã™ã€‚

```bash
# 1. ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pipx install .

# 2. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ
workflow-engine planner owner/repo --story "..."
workflow-engine worker owner/repo --once --verbose
workflow-engine reviewer owner/repo --once --verbose
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¢ç´¢é †ï¼ˆCLIï¼‰

1. `WORKFLOW_CONFIG` ç’°å¢ƒå¤‰æ•°ï¼ˆæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
2. å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `./config/repos.yml`ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
3. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã® `config/repos.yml`

## é–‹ç™ºè€…å‘ã‘ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
uv run pytest --cov=shared --cov=planner-agent --cov=worker-agent --cov=reviewer-agent

# ãƒªãƒ³ãƒˆ
uv run ruff check .

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
uv run ruff format .

# å‹ãƒã‚§ãƒƒã‚¯
uv run mypy .

# pre-commitã‚’å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè¡Œ
uv run pre-commit run --all-files
```

## LLMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š

`config/repos.yml` ã§ `llm_backend` ã‚’è¨­å®š:

```yaml
repositories:
  - name: owner/repo
    llm_backend: codex    # "codex" (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) ã¾ãŸã¯ "claude"
    codex_cli: codex      # Codex CLIã®ãƒ‘ã‚¹
    claude_cli: claude    # Claude Code CLIã®ãƒ‘ã‚¹
```

| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | CLI | èª¬æ˜ |
|-------------|-----|------|
| `codex` | `codex` | OpenAI Codexï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `claude` | `claude` | Anthropic Claude Code |

## ä½¿ã„æ–¹

### æœ€çŸ­é‹ç”¨ãƒ•ãƒ­ãƒ¼ï¼ˆã‚ãªãŸãŒã‚„ã‚‹ã“ã¨ï¼‰

ã¯ã„ã€ãã®ç†è§£ã§åˆã£ã¦ã„ã¾ã™ã€‚åŸºæœ¬ã¯ã€ŒPlannerã«ä¾é ¼ã—ã¦IssueåŒ–ã€ã—ã¦ã‹ã‚‰ã€Worker/Reviewerã«å›ã—ã¾ã™ã€‚

1. Plannerã«è¦æœ›ã‚’æ¸¡ã—ã¦IssueåŒ–ã™ã‚‹
```bash
uv run planner-agent/main.py owner/repo --story "ã“ã‚Œã‚’IssueåŒ–ã—ã¦: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ "
```
2. Workerã‚’èµ·å‹•ã—ã¦ `status:ready` Issue ã‚’å®Ÿè£…ã•ã›ã‚‹
```bash
uv run worker-agent/main.py owner/repo --verbose
```
3. Reviewerã‚’èµ·å‹•ã—ã¦ `status:reviewing` PR ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã›ã‚‹
```bash
uv run reviewer-agent/main.py owner/repo --verbose
```
4. Plannerã®ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã‚‚å›ã™ï¼ˆæ¨å¥¨ï¼‰
```bash
uv run planner-agent/main.py owner/repo --daemon --verbose
```

é‹ç”¨ä¸Šã¯3ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `planner --daemon` / `worker` / `reviewer` ã‚’å¸¸é§ã•ã›ã€ã‚ãªãŸã¯æ–°è¦è¦æœ›ã‚’ `planner --story` ã§æŠ•å…¥ã™ã‚‹å½¢ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

### Planner Agentï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼‰

```bash
# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ä»•æ§˜ä½œæˆ
uv run planner-agent/main.py owner/repo

# éå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ä»•æ§˜ä½œæˆ
uv run planner-agent/main.py owner/repo --story "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ "
```

### Worker Agentï¼ˆãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼‰

```bash
# ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆå¸¸é§ï¼‰
uv run worker-agent/main.py owner/repo

# ä¸€å›ã ã‘å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
uv run worker-agent/main.py owner/repo --once

# ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
uv run worker-agent/main.py owner/repo --verbose
```

### Reviewer Agentï¼ˆãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼‰

```bash
# ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆå¸¸é§ï¼‰
uv run reviewer-agent/main.py owner/repo

# ä¸€å›ã ã‘å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
uv run reviewer-agent/main.py owner/repo --once
```

## è‡ªå‹•ãƒãƒ¼ã‚¸æ©Ÿèƒ½

Reviewer AgentãŒ`status:approved`ã‚’ä»˜ä¸ã—ãŸç›´å¾Œã«ã€è‡ªå‹•ã§ãƒãƒ¼ã‚¸ã‚’è©¦è¡Œã§ãã¾ã™ã€‚
ãƒªãƒã‚¸ãƒˆãƒªã”ã¨ã«opt-inã§æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

```yaml
repositories:
  - name: owner/repo
    auto_merge: true        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: false
    merge_method: squash    # "squash" (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ), "merge", "rebase"
```

- `auto_merge`: `true`ã§è‡ªå‹•ãƒãƒ¼ã‚¸ã‚’æœ‰åŠ¹åŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `false`ï¼‰
- `merge_method`: ãƒãƒ¼ã‚¸æ–¹æ³•ã‚’æŒ‡å®š
  - `squash`: å…¨ã‚³ãƒŸãƒƒãƒˆã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹ï¼ˆæ¨å¥¨ï¼‰
  - `merge`: ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆ
  - `rebase`: ãƒªãƒ™ãƒ¼ã‚¹ã—ã¦ãƒãƒ¼ã‚¸

## ãƒ©ãƒ™ãƒ«ä½“ç³»

| ãƒ©ãƒ™ãƒ« | æ„å‘³ |
|--------|------|
| `status:ready` | å®Ÿè£…æº–å‚™å®Œäº†ï¼ˆWorkerå¾…ã¡ï¼‰ |
| `status:implementing` | å®Ÿè£…ä¸­ï¼ˆWorkerãŒãƒ†ã‚¹ãƒˆç”Ÿæˆãƒ»å®Ÿè£…ä¸­ï¼‰ |
| `status:testing` | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ï¼ˆWorkerãŒpytestå®Ÿè¡Œä¸­ï¼‰ |
| `status:reviewing` | ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ï¼ˆReviewerå¾…ã¡ã€CIé€šéå¾Œï¼‰ |
| `status:in-review` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ï¼ˆReviewerãŒãƒ­ãƒƒã‚¯ä¸­ï¼‰ |
| `status:approved` | ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èªæ¸ˆã¿ |
| `status:changes-requested` | ä¿®æ­£è¦æ±‚ |
| `status:ci-failed` | CIå¤±æ•—ï¼ˆè‡ªå‹•ä¿®æ­£3å›å¤±æ•—å¾Œï¼‰ |
| `status:failed` | å‡¦ç†å¤±æ•— |

**ãƒ©ãƒ™ãƒ«é·ç§»ãƒ•ãƒ­ãƒ¼:**
```
ready â†’ implementing â†’ testing â†’ CIç›£è¦– â†’ reviewing â†’ in-review â†’ approved
                â†‘           â†“       â†“ (å¤±æ•—)              â†“
                â””â”€â”€â”€(retry)â”€â”˜    ci-failed    changes-requested
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
workflow-engine/
â”œâ”€â”€ shared/              # å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ github_client.py # GitHub API (gh CLI wrapper)
â”‚   â”œâ”€â”€ llm_client.py    # LLMçµ±ä¸€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (codex/claude)
â”‚   â”œâ”€â”€ lock.py          # åˆ†æ•£ãƒ­ãƒƒã‚¯æ©Ÿæ§‹
â”‚   â””â”€â”€ config.py        # è¨­å®šç®¡ç†
â”œâ”€â”€ planner-agent/       # Planner ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â””â”€â”€ main.py
â”œâ”€â”€ worker-agent/        # Worker ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ git_operations.py
â”œâ”€â”€ reviewer-agent/      # Reviewer ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â””â”€â”€ main.py
â””â”€â”€ config/
    â””â”€â”€ repos.yml        # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```

## ãƒ­ãƒƒã‚¯æ©Ÿæ§‹

è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ç«¶åˆã‚’é˜²ãã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®å¾©æ—§ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ­ãƒƒã‚¯æ©Ÿæ§‹ã€‚

**ãƒ­ãƒƒã‚¯å–å¾—ãƒ•ãƒ­ãƒ¼:**
1. **æ—¢å­˜ãƒ­ãƒƒã‚¯ç¢ºèª**: 30åˆ†ä»¥å†…ã®ACKã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
   - ã‚ã‚Š â†’ ã‚¹ã‚­ãƒƒãƒ—ï¼ˆä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‡¦ç†ä¸­ï¼‰
   - ãªã— â†’ æ¬¡ã¸
2. **ACKã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿**: `ACK:worker:agent-id:timestamp` å½¢å¼ã§æŠ•ç¨¿
3. **2ç§’å¾…æ©Ÿ**: ç«¶åˆæ¤œå‡ºã®ãŸã‚ã®å¾…æ©Ÿ
4. **ç«¶åˆè§£æ±º**: 30ç§’ä»¥å†…ã®ACKã®ã†ã¡æœ€å¤ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒå‹è€…
5. **ãƒ©ãƒ™ãƒ«é·ç§»å®Ÿè¡Œ**: å‹è€…ãŒãƒ©ãƒ™ãƒ«ã‚’å¤‰æ›´

**ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨å¾©æ—§:**
- **30åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ACKã‹ã‚‰30åˆ†çµŒéã—ãŸãƒ­ãƒƒã‚¯ã¯ç„¡åŠ¹
- **è‡ªå‹•å†é–‹**: åˆ¥ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œã«è‡ªå‹•å–å¾—
- **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDè¿½è·¡**: å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä¸€æ„ã®IDï¼ˆä¾‹: `worker-a1b2c3d4`ï¼‰

**ACKã‚³ãƒ¡ãƒ³ãƒˆä¾‹:**
```
ACK:worker:worker-a1b2c3d4:1706123456789
```

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã‚‚30åˆ†å¾Œã«ã¯è‡ªå‹•çš„ã«åˆ¥ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä½œæ¥­ã‚’å†é–‹ã§ãã¾ã™ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Issue/PRãŒå‡¦ç†ã•ã‚Œãªã„

1. ãƒ©ãƒ™ãƒ«ãŒæ­£ã—ã„ã‹ç¢ºèª
2. `--verbose` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ­ã‚°ç¢ºèª
3. `gh auth status` ã§èªè¨¼ç¢ºèª

### LLMãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

- å¤§ããªãƒªãƒã‚¸ãƒˆãƒªã§ã¯æ™‚é–“ãŒã‹ã‹ã‚‹
- `shared/llm_client.py` ã® timeout å€¤ã‚’èª¿æ•´

### ãƒ­ãƒƒã‚¯ç«¶åˆãŒé »ç™º

- `poll_interval` ã‚’èª¿æ•´ã—ã¦è² è·åˆ†æ•£
- è¤‡æ•°Worker/Reviewerã®å ´åˆã¯é–“éš”ã‚’ãšã‚‰ã™

## Systemdã§ã®å¸¸é§åŒ–

```ini
# /etc/systemd/system/workflow-worker@.service
[Unit]
Description=Workflow Worker Agent for %i
After=network.target

[Service]
Type=simple
WorkingDirectory=/path/to/workflow-engine
ExecStart=/usr/bin/python3 worker-agent/main.py %i
Restart=always
RestartSec=60
Environment=WORKFLOW_CONFIG=/path/to/repos.yml

[Install]
WantedBy=multi-user.target
```

```bash
# æœ‰åŠ¹åŒ–
sudo systemctl enable workflow-worker@owner-repo
sudo systemctl start workflow-worker@owner-repo
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT
