# 開発選択肢の精査メモ（2026-02-09）

この文書は、要望一覧を「実装済み」「部分実装」「未実装（必須/推奨）」に分けた現状整理です。  
特にE2E運用のため、`dry-run` は必須機能として扱います。

## 1. 実装済み

### ステータスダッシュボード
- 状態: 実装済み（CLI）
- 根拠: `scripts/status.py`
- 内容: Issue/PRを取得し、`status:*` ラベルを一覧表示

### ヘルスチェック（基本）
- 状態: 実装済み（基本）
- 根拠: `scripts/health_check.py`
- 内容: `gh/uv/git` コマンド存在、`gh auth status`、`config/repos.yml` 検証

### pre-commit導入
- 状態: 実装済み
- 根拠: `README.md` の手順、CI内の pre-commit 実行ガード

### GitHub Actions導入
- 状態: 実装済み
- 根拠: `.github/workflows/ci.yml`, `README.md` CIバッジ
- 内容: 3.11/3.12/3.13 matrix、ruff/mypy/pytest、pre-commit条件実行

### 他プロジェクトで利用するための準備
- 状態: 実装済み（基本）
- 根拠: `shared/config.py` の複数repo設定、`scripts/launch.*`、`workflow-engine` CLI導線（README）

### テスト機能（TDD + CI連携 + Reviewer連携）
- 状態: 実装済み（中核）
- 根拠: `worker-agent/main.py`, `reviewer-agent/main.py`, `shared/llm_client.py`, 各種 `tests/test_worker.py`
- 内容:
  - 実装前テスト生成
  - テスト失敗時の自動修正ループ
  - CI失敗時の自動修正ループ
  - `changes-requested` 再実装ループ
  - Plannerへのエスカレーション

### Planner側のループロジック
- 状態: 実装済み
- 根拠: `planner-agent/main.py` の `--daemon`, `run_daemon`, `ESCALATION:*` 処理

### git worktree
- 状態: 実装済み（Worker側）
- 根拠: `shared/workspace.py`, `worker-agent/main.py` の `_issue_workspace`
- 注記: 「Planner側 worktree」は未対応（必要なら別Issue）

## 2. 部分実装（要強化）

### ヘルスチェック強化
- 現状: 依存コマンド/認証/設定の静的チェックのみ
- 不足:
  - `codex` / `claude` の実行可否チェック
  - 各エージェントの稼働状態チェック（PID/tmux/systemd等）
  - GitHub API疎通の実コール（read-only）

### ステータス可視化のリアルタイム性
- 現状: `status.py` は単発表示
- 不足:
  - 更新し続けるターミナルUI（watchモード）
  - 「各エージェントが今何をしているか」の進行表示

### キュー型処理の明確化
- 現状: ポーリングで Issue/PR を取りに行く方式は実装済み
- 不足:
  - 明示的な内部キュー構造
  - GitHubイベント（Webhook）経由でのキュー投入

## 3. 未実装（必須）

### A. Dry-runモード（最優先）
- 必要性: E2Eで安全に動作確認するため必須
- 要件:
  - `planner/worker/reviewer` すべてで有効化可能
  - GitHub変更系操作（create/edit/comment/label/push/merge）を抑止
  - 「実行予定操作」をログに出す
  - read-only操作（list/view/check）だけ許可
  - CIやテストは「実行する dry-run」と「完全シミュレーション」の2段階が望ましい

### B. ライブ運用監視ターミナル
- 必要性: 長時間運用の監視・障害検知に必須
- 要件:
  - `--watch` モードで定期更新
  - エージェント別の現在処理（issue/pr番号、フェーズ、経過時間）
  - stale/failed/escalation の強調表示

## 4. 未実装（推奨）

### Ollama対応
- 内容: `llm_backend` に `ollama` 追加、CLI/HTTP接続層の実装

### 知識共有ストア
- 内容:
  - 浅い概要 + 深い詳細の2層構造
  - 古い情報の要約・圧縮（情報減衰）
  - エージェントが必要に応じて深掘り取得

### 自動化の拡張
- 内容:
  - mypy/ruff/test結果の要約を次アクション入力へ自動反映
  - 「AIが理解しないと進めないデータ」を標準フォーマットで返す

## 5. 優先順位（提案）

1. Dry-runモード（A）
2. ライブ運用監視ターミナル（B）
3. ヘルスチェック強化（agent稼働確認 + LLM疎通）
4. イベント駆動キュー（Webhook連携）
5. Ollama対応
6. 知識共有ストア

## 6. 次に切るIssue候補

- `feat: dry-run mode across planner/worker/reviewer`
- `feat: live status monitor with watch mode`
- `feat: enhanced health check (agent runtime + llm connectivity)`
- `feat: webhook event ingestion queue`
- `feat: add ollama backend support`
- `feat: structured knowledge store for long-term context`
